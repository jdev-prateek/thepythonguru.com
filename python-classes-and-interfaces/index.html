<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Python Classes and Interfaces - ThePythonGuru.com</title>

    
    



    <meta name="description" content="As an object-oriented programming language, Python supports a full range of features, such as inheritance, polymorphism, and encapsulation. Getting things done in Python often requires writing new classes and defining how they interact through their inter"/>



    <link rel="canonical" href="index.html">


<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Python Classes and Interfaces" />

    <meta name="description" content="As an object-oriented programming language, Python supports a full range of features, such as inheritance, polymorphism, and encapsulation. Getting things done in Python often requires writing new classes and defining how they interact through their inter"/>


<meta property="og:url" content="https://thepythonguru.com/python-classes-and-interfaces/" />
<meta property="og:site_name" content="thepythonguru.com" />


<meta property="article:publisher" content="https://www.facebook.com/thepythonguru" />



<meta name="twitter:card" content="summary_large_image" />

    <meta name="twitter:description" content="As an object-oriented programming language, Python supports a full range of features, such as inheritance, polymorphism, and encapsulation. Getting things done in Python often requires writing new classes and defining how they interact through their inter" />


<meta name="twitter:title" content="Python Classes and Interfaces" />
<meta name="twitter:site" content="@thepythonguru" />

<meta name="twitter:creator" content="@thepythonguru" />




    
    
    


    
    
    


    <link rel="alternate" type="application/rss+xml" title="RSS" href="../feed.xml/index.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="../static/wiki/favicon.png" sizes="32x32" />

    <link rel="stylesheet" href="../static/CACHE/css/output.6be9976864ee.css" type="text/css" />

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-39121661-7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-39121661-7');
    </script>


</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-default navbar-inverse" >
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">ThePythonGuru</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse " id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                

                <li >
                    <a href="../index.html">Start Here</a>
                </li>
                <li >
                    <a href="../blog/index.html">Blog</a>
                </li>
                
                
                
                <li >
                    <a href="../contact-us/index.html">Contact</a>
                </li>
                <li >
                    <a href="../write-for-us/index.html">Write For Us</a>
                </li>
                <li class="dropdown">
                    <a href="index.html#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                       aria-haspopup="true" aria-expanded="false">Tools <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="../tools/pygments-demo/index.html">Pygments Demo</a></li>
                    </ul>
                </li>




                
                
                
                
                
                
                
                
                
            </ul>

            
            
            
            
            
            
            
            

        </div>



        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<div class="container">

    

    

    <div class="row">

        
        <div class="main">
            <div  class="col-lg-8 col-md-8 col-sm-12">
                

    


    
        

<ol class="breadcrumb">

    <li><a href="../index.html">Home</a></li>

    
        

        
            <li><a href="../blog/index.html">Blog</a></li>
        

        
            <li class="active">Python Classes and Interfaces</li>
        
    

</ol>


    



<p class="advert">
    (Sponsors) Get started learning Python with <a rel="sponsored noopener" target="_blank" href="https://www.datacamp.com/?utm_source=thepythonguru&utm_campaign=thepythonguru_tutorials">DataCamp's</a>
    free <a rel="sponsored noopener" target="_blank" href="https://www.datacamp.com/courses/intro-to-python-for-data-science/?utm_source=thepythonguru&utm_campaign=thepythonguru_tutorials">Intro to Python tutorial</a>.

    Learn Data Science by completing interactive coding challenges and watching videos by expert instructors.
    <a rel="sponsored noopener" target="_blank" href="https://www.datacamp.com/courses/intro-to-python-for-data-science/?utm_source=thepythonguru&utm_campaign=thepythonguru_tutorials">Start Now!</a>
</p>
<hr>

<h1>Python Classes and Interfaces</h1>




    <p><i class="fa fa-clock-o" aria-hidden="true"></i>
        Updated on Jan 07, 2020
    </p>


<hr>




        <div class="admonition note">        <p class="admonition-title"><strong><i class="fa fa-info-circle" aria-hidden="true"></i> note:        </strong></p><p>This is a except from <a href="http://www.informit.com/store/effective-python-90-specific-ways-to-write-better-python-9780134853987">Effective Python: 90 Specific Ways to Write Better Python, 2nd Edition
</a></p></div>
        <p>As an object-oriented programming language, Python supports a full range of features, such as inheritance, polymorphism, and encapsulation. Getting things done in Python often requires writing new classes and defining how they interact through their interfaces and hierarchies.</p><p>Python&#39;s classes and inheritance make it easy to express a program&#39;s intended behaviors with objects. They allow you to improve and expand functionality over time. They provide flexibility in an environment of changing requirements. Knowing how to use them well enables you to write maintainable code.</p><span id="item-37-compose-classes-instead-of-nesting-many-levels-of-built-in-types" class="anchor-target"></span><h2 class="heading">Item 37: Compose Classes Instead of Nesting Many Levels of Built-in Types <a class="header-link" href="index.html#item-37-compose-classes-instead-of-nesting-many-levels-of-built-in-types">#</a></h2><hr>
<p>Python&#39;s built-in dictionary type is wonderful for maintaining dynamic internal state over the lifetime of an object. By dynamic, I mean situations in which you need to do bookkeeping for an unexpected set of identifiers. For example, say that I want to record the grades of a set of students whose names aren&#39;t known in advance. I can define a class to store the names in a dictionary instead of using a predefined attribute for each student:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleGradebook</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">add_student</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">report_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">score</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">average_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">grades</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">grades</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">grades</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>Using the class is simple:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">book</span> <span class="o">=</span> <span class="n">SimpleGradebook</span><span class="p">()</span>
<span class="n">book</span><span class="o">.</span><span class="n">add_student</span><span class="p">(</span><span class="s1">&#39;Isaac Newton&#39;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Isaac Newton&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Isaac Newton&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Isaac Newton&#39;</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">average_grade</span><span class="p">(</span><span class="s1">&#39;Isaac Newton&#39;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mf">90.0</span>
</pre></div>
</td></tr></table></div><p>Dictionaries and their related built-in types are so easy to use that there&#39;s a danger of overextending them to write brittle code. For example, say that I want to extend the SimpleGradebook class to keep a list of grades by subject, not just overall. I can do this by changing the <code>_grades</code> dictionary to map student names (its keys) to yet another dictionary (its values). The innermost dictionary will map subjects (its keys) to a list of grades (its values). Here, I do this by using a <code>defaultdict</code> instance for the inner dictionary to handle missing subjects (see Item 17: &quot;Prefer defaultdict Over setdefault to Handle Miss
ing Items in Internal State&quot; for background):</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span> <span class="nc">BySubjectGradebook</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Outer dict</span>
    <span class="k">def</span> <span class="nf">add_student</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="c1"># Inner dict</span>
</pre></div>
</td></tr></table></div><p>This seems straightforward enough. The <code>report_grade</code> and <code>average_grade</code> methods gain quite a bit of complexity to deal with the multilevel dictionary, but it&#39;s seemingly manageable:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">report_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">grade</span><span class="p">):</span>
       <span class="n">by_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
       <span class="n">grade_list</span> <span class="o">=</span> <span class="n">by_subject</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span>
       <span class="n">grade_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">average_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
       <span class="n">by_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
       <span class="n">total</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
       <span class="k">for</span> <span class="n">grades</span> <span class="ow">in</span> <span class="n">by_subject</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
           <span class="n">total</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">grades</span><span class="p">)</span>
           <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">grades</span><span class="p">)</span>
       <span class="k">return</span> <span class="n">total</span> <span class="o">/</span> <span class="n">count</span>
</pre></div>
</td></tr></table></div><p>Using the class remains simple:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">book</span> <span class="o">=</span> <span class="n">BySubjectGradebook</span><span class="p">()</span>
<span class="n">book</span><span class="o">.</span><span class="n">add_student</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Math&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Math&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Gym&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Gym&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">average_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mf">81.25</span>
</pre></div>
</td></tr></table></div><p>Now, imagine that the requirements change again. I also want to track the weight of each score toward the overall grade in the class so that midterm and final exams are more important than pop quizzes. One way to implement this feature is to change the innermost dictionary; instead of mapping subjects (its keys) to a list of grades (its values), I can use the tuple of (<code>score</code>, <code>weight</code>) in the values <code>list</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WeightedGradebook</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">add_student</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">report_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="n">by_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">grade_list</span> <span class="o">=</span> <span class="n">by_subject</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span>
        <span class="n">grade_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">score</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>
</pre></div>
</td></tr></table></div><p>Although the changes to <code>report_grade</code> seem simple—just make the grade list store tuple instances—the <code>average_grade</code> method now has a loop within a loop and is difficult to read:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">average_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">by_subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="n">score_sum</span><span class="p">,</span> <span class="n">score_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">subject</span><span class="p">,</span> <span class="n">scores</span> <span class="ow">in</span> <span class="n">by_subject</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">subject_avg</span><span class="p">,</span> <span class="n">total_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
            <span class="n">subject_avg</span> <span class="o">+=</span> <span class="n">score</span> <span class="o">*</span> <span class="n">weight</span>
            <span class="n">total_weight</span> <span class="o">+=</span> <span class="n">weight</span>

        <span class="n">score_sum</span> <span class="o">+=</span> <span class="n">subject_avg</span> <span class="o">/</span> <span class="n">total_weight</span>
        <span class="n">score_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">score_sum</span> <span class="o">/</span> <span class="n">score_count</span>
</pre></div>
</td></tr></table></div><p>Using the class has also gotten more difficult. It&#39;s unclear what all of the numbers in the positional arguments mean:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">book</span> <span class="o">=</span> <span class="n">WeightedGradebook</span><span class="p">()</span>
<span class="n">book</span><span class="o">.</span><span class="n">add_student</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Math&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Math&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Math&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Gym&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">,</span> <span class="s1">&#39;Gym&#39;</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">average_grade</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mf">80.25</span>
</pre></div>
</td></tr></table></div><p>When you see complexity like this, it&#39;s time to make the leap from built-in types like dictionaries, tuples, sets, and lists to a hierarchy of
classes.</p><p>In the grades example, at first I didn&#39;t know I&#39;d need to support weighted grades, so the complexity of creating classes seemed unwarranted. Python&#39;s built-in dictionary and tuple types made it easy to keep going, adding layer after layer to the internal bookkeeping. But you should avoid doing this for more than one level of nesting; using dictionaries that contain dictionaries makes your code hard to read by other programmers and sets you up for a maintenance nightmare.</p><p>As soon as you realize that your bookkeeping is getting complicated, break it all out into classes. You can then provide well-defined interfaces that better encapsulate your data. This approach also enables you to create a layer of abstraction between your interfaces and your concrete implementations.</p><span id="refactoring-to-classes" class="anchor-target"></span><h3 class="heading">Refactoring to Classes <a class="header-link" href="index.html#refactoring-to-classes">#</a></h3><hr>
<p>There are many approaches to refactoring (see Item 89: &quot;Consider warnings to Refactor and Migrate Usage&quot; for another). In this case,</p><p>I can start moving to classes at the bottom of the dependency tree: a single grade. A class seems too heavyweight for such simple information. A tuple, though, seems appropriate because grades are immutable. Here, I use the tuple of (score, weight) to track grades in a list:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">grades</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">95</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">))</span>
<span class="n">grades</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">85</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">))</span>
<span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">score</span> <span class="o">*</span> <span class="n">weight</span> <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">grades</span><span class="p">)</span>
<span class="n">total_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weight</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">grades</span><span class="p">)</span>
<span class="n">average_grade</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">total_weight</span>
</pre></div>
</td></tr></table></div><p>I used <code>_</code> (the underscore variable name, a Python convention for unused variables) to capture the first entry in each grade&#39;s tuple and ignore it when calculating the <code>total_weight</code>.</p><p>The problem with this code is that tuple instances are positional. For example, if I want to associate more information with a grade, such as a set of notes from the teacher, I need to rewrite every usage of the two-tuple to be aware that there are now three items present instead
of two, which means I need to use <code>_</code>further to ignore certain indexes:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">grades</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">grades</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">95</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s1">&#39;Great job&#39;</span><span class="p">))</span>
<span class="n">grades</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">85</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="s1">&#39;Better next time&#39;</span><span class="p">))</span>
<span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">score</span> <span class="o">*</span> <span class="n">weight</span> <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">grades</span><span class="p">)</span>
<span class="n">total_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">weight</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">grades</span><span class="p">)</span>
<span class="n">average_grade</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">total_weight</span>
</pre></div>
</td></tr></table></div><p>This pattern of extending tuples longer and longer is similar to deepening layers of dictionaries. As soon as you find yourself going longer than a two-tuple, it&#39;s time to consider another approach.</p><p>The <code>namedtuple</code> type in the collections built-in module does exactly what I need in this case: It lets me easily define tiny, immutable data classes:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">Grade</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Grade&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div><p>These classes can be constructed with positional or keyword arguments. The fields are accessible with named attributes. Having named attributes makes it easy to move from a <code>namedtuple</code> to a class later if the requirements change again and I need to, say, support mutability or behaviors in the simple data containers.</p><span id="limitations-of-namedtuple" class="anchor-target"></span><h3 class="heading">Limitations of namedtuple <a class="header-link" href="index.html#limitations-of-namedtuple">#</a></h3><hr>
<p>Although <code>namedtuple</code> is useful in many circumstances, it&#39;s important to understand when it can do more harm than good:</p>
<ul>
<li><p>You can&#39;t specify default argument values for <code>namedtuple</code> classes. This makes them unwieldy when your data may have many optional properties. If you find yourself using more than a handful of attributes, using the built-in dataclasses module may be a better choice.</p></li>
<li><p>The attribute values of namedtuple instances are still accessible using numerical indexes and iteration. Especially in externalized APIs, this can lead to unintentional usage that makes it harder to move to a real class later. If you&#39;re not in control of all of the usage of your <code>namedtuple</code> instances, it&#39;s better to explicitly define a new class.</p></li>
</ul>
<p>Next, I can write a class to represent a single subject that contains a
set of grades:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Subject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">report_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Grade</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">average_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">total</span><span class="p">,</span> <span class="n">total_weight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">grade</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grades</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">grade</span><span class="o">.</span><span class="n">score</span> <span class="o">*</span> <span class="n">grade</span><span class="o">.</span><span class="n">weight</span>
            <span class="n">total_weight</span> <span class="o">+=</span> <span class="n">grade</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">return</span> <span class="n">total</span> <span class="o">/</span> <span class="n">total_weight</span>
</pre></div>
</td></tr></table></div><p>Then, I write a class to represent a set of subjects that are being studied by a single student:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Student</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subjects</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Subject</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subjects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">average_grade</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">total</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subjects</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">subject</span><span class="o">.</span><span class="n">average_grade</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">total</span> <span class="o">/</span> <span class="n">count</span>
</pre></div>
</td></tr></table></div><p>Finally, I&#39;d write a container for all of the students, keyed dynamically by their names:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Gradebook</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_students</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Student</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_student</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_students</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</pre></div>
</td></tr></table></div><p>The line count of these classes is almost double the previous implementation&#39;s size. But this code is much easier to read. The example driving the classes is also more clear and extensible:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">book</span> <span class="o">=</span> <span class="n">Gradebook</span><span class="p">()</span>
<span class="n">albert</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">get_student</span><span class="p">(</span><span class="s1">&#39;Albert Einstein&#39;</span><span class="p">)</span>
<span class="n">math</span> <span class="o">=</span> <span class="n">albert</span><span class="o">.</span><span class="n">get_subject</span><span class="p">(</span><span class="s1">&#39;Math&#39;</span><span class="p">)</span>
<span class="n">math</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">math</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">math</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">)</span>
<span class="n">gym</span> <span class="o">=</span> <span class="n">albert</span><span class="o">.</span><span class="n">get_subject</span><span class="p">(</span><span class="s1">&#39;Gym&#39;</span><span class="p">)</span>
<span class="n">gym</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">)</span>
<span class="n">gym</span><span class="o">.</span><span class="n">report_grade</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">albert</span><span class="o">.</span><span class="n">average_grade</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mf">80.25</span>
</pre></div>
</td></tr></table></div><p>It would also be possible to write backward-compatible methods to help migrate usage of the old API style to the new hierarchy of objects.</p><span id="things-to-remember" class="anchor-target"></span><h3 class="heading">Things to Remember <a class="header-link" href="index.html#things-to-remember">#</a></h3><hr>

<ul>
<li>Avoid making dictionaries with values that are dictionaries, long tuples, or complex nestings of other built-in types.</li>
<li>Use <code>namedtuple</code> for lightweight, immutable data containers before you need the flexibility of a full class.</li>
<li>Move your bookkeeping code to using multiple classes when your internal state dictionaries get complicated.</li>
</ul>
<span id="item-38-accept-functions-instead-of-classes-for-simple-interfaces" class="anchor-target"></span><h2 class="heading">Item 38: Accept Functions Instead of Classes for Simple Interfaces <a class="header-link" href="index.html#item-38-accept-functions-instead-of-classes-for-simple-interfaces">#</a></h2><hr>
<p>Many of Python&#39;s built-in APIs allow you to customize behavior by passing in a function. These hooks are used by APIs to call back your code while they execute. For example, the list type&#39;s sort method takes an optional key argument that&#39;s used to determine each index&#39;s value for sorting (see Item 14: &quot;Sort by Complex Criteria Using the key Parameter&quot; for details). Here, I sort a list of names based on their lengths by providing the len built-in function as the key hook:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Socrates&#39;</span><span class="p">,</span> <span class="s1">&#39;Archimedes&#39;</span><span class="p">,</span> <span class="s1">&#39;Plato&#39;</span><span class="p">,</span> <span class="s1">&#39;Aristotle&#39;</span><span class="p">]</span>
<span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="p">[</span><span class="s1">&#39;Plato&#39;</span><span class="p">,</span> <span class="s1">&#39;Socrates&#39;</span><span class="p">,</span> <span class="s1">&#39;Aristotle&#39;</span><span class="p">,</span> <span class="s1">&#39;Archimedes&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div><p>In other languages, you might expect hooks to be defined by an abstract class. In Python, many hooks are just stateless functions with well-defined arguments and return values. Functions are ideal for hooks because they are easier to describe and simpler to define than classes. Functions work as hooks because Python has first-class functions: Functions and methods can be passed around and referenced like any other value in the language. For example, say that I want to customize the behavior of the <code>defaultdict</code> class (see Item 17: &quot;Prefer <code>defaultdict</code> Over <code>setdefault</code> to
Handle Missing Items in Internal State&quot; for background). This data structure allows you to supply a function that will be called with no arguments each time a missing key is accessed. The function must return the default value that the missing key should have in the dictionary. Here, I define a hook that logs each time a key is missing and returns 0 for the default value:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_missing</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Key added&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</td></tr></table></div><p>Given an initial dictionary and a set of desired increments, I can cause the log_missing function to run and print twice (for &#39;red&#39; and &#39;orange&#39;):</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="n">current</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">increments</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="mi">17</span><span class="p">),</span>
<span class="p">(</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">log_missing</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">increments</span><span class="p">:</span>
<span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;After: &#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">Before</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">Key</span> <span class="n">added</span>
<span class="n">Key</span> <span class="n">added</span>
<span class="n">After</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;green&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
</pre></div>
</td></tr></table></div><p>Supplying functions like log_missing makes APIs easy to build and test because it separates side effects from deterministic behavior. For example, say I now want the default value hook passed to <code>defaultdict</code> to count the total number of keys that were missing. One way to achieve this is by using a stateful closure (see Item 21: &quot;Know How Closures Interact with Variable Scope&quot; for details). Here, I define a helper function that uses such a closure as the default value hook:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">increment_with_report</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">increments</span><span class="p">):</span>
    <span class="n">added_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">missing</span><span class="p">():</span>
        <span class="n">nonlocal</span> <span class="n">added_count</span> <span class="c1"># Stateful closure</span>
        <span class="n">added_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">missing</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">increments</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">added_count</span>
</pre></div>
</td></tr></table></div><p>Running this function produces the expected result (2), even though the <code>defaultdict</code> has no idea that the missing hook maintains state. Another benefit of accepting simple functions for interfaces is that it&#39;s easy to add functionality later by hiding state in a closure:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">increment_with_report</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">increments</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</td></tr></table></div><p>The problem with defining a closure for stateful hooks is that it&#39;s harder to read than the stateless function example. Another approach is to define a small class that encapsulates the state you want to track:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CountMissing</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</td></tr></table></div><p>In other languages, you might expect that now <code>defaultdict</code> would have to be modified to accommodate the interface of <code>CountMissing</code>. But in Python, thanks to first-class functions, you can reference the <code>CountMissing.missing</code> method directly on an object and pass it to <code>defaultdict</code> as the default value hook. It&#39;s trivial to have an object instance&#39;s method satisfy a function interface:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="n">CountMissing</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">missing</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span> <span class="c1"># Method ref</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">increments</span><span class="p">:</span>
    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
<span class="k">assert</span> <span class="n">counter</span><span class="o">.</span><span class="n">added</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</td></tr></table></div><p>Using a helper class like this to provide the behavior of a stateful closure is clearer than using the increment_with_report function, as above. However, in isolation, it&#39;s still not immediately obvious what the purpose of the CountMissing class is. Who constructs a <code>CountMissing</code> object? Who calls the missing method? Will the class need other public methods to be added in the future? Until you see its usage with <code>defaultdict</code>, the class is a mystery.</p><p>To clarify this situation, Python allows classes to define the <code>__call__</code> special method. <code>__call__</code> allows an object to be called just like a function. It also causes the callable built-in function to return True for such an instance, just like a normal function or method. All objects
that can be executed in this manner are referred to as <em>callables</em>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BetterCountMissing</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">BetterCountMissing</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">counter</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>Here, I use a BetterCountMissing instance as the default value hook for a <code>defaultdict</code> to track the number of missing keys that were added:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="n">BetterCountMissing</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span> <span class="c1"># Relies on __call__</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">increments</span><span class="p">:</span>
    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
<span class="k">assert</span> <span class="n">counter</span><span class="o">.</span><span class="n">added</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>
</td></tr></table></div><p>This is much clearer than the CountMissing.missing example. The <code>__call__</code> method indicates that a class&#39;s instances will be used somewhere a function argument would also be suitable (like API hooks). It directs new readers of the code to the entry point that&#39;s responsible for the class&#39;s primary behavior. It provides a strong hint that the goal of the class is to act as a stateful closure. Best of all, <code>defaultdict</code> still has no view into what&#39;s going on when
you use <code>__call__</code>. All that <code>defaultdict</code> requires is a function for the default value hook. Python provides many different ways to satisfy a simple function interface, and you can choose the one that works best for what you need to accomplish.</p><span id="things-to-remember" class="anchor-target"></span><h3 class="heading">Things to Remember <a class="header-link" href="index.html#things-to-remember">#</a></h3><hr>

<ul>
<li>Instead of defining and instantiating classes, you can often simply use functions for simple interfaces between components in Python.</li>
<li>References to functions and methods in Python are first class, meaning they can be used in expressions (like any other type).</li>
<li>The <code>__call__</code> special method enables instances of a class to be called like plain Python functions.</li>
<li>When you need a function to maintain state, consider defining a class that provides the <code>__call__</code> method instead of defining a stateful closure.</li>
</ul>
<span id="item-39-use-classmethod-polymorphism-to-construct-objects-generically" class="anchor-target"></span><h2 class="heading">Item 39: Use @classmethod Polymorphism to Construct Objects Generically <a class="header-link" href="index.html#item-39-use-classmethod-polymorphism-to-construct-objects-generically">#</a></h2><hr>
<p>In Python, not only do objects support polymorphism, but classes do as well. What does that mean, and what is it good for? Polymorphism enables multiple classes in a hierarchy to implement their own unique versions of a method. This means that many classes can fulfill the same interface or abstract base class while providing different functionality (see Item 43: &quot;Inherit from collections.abc for Custom Container Types&quot;).</p><p>For example, say that I&#39;m writing a MapReduce implementation, and I want a common class to represent the input data. Here, I define such a class with a read method that must be defined by subclasses:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InputData</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>
</td></tr></table></div><p>I also have a concrete subclass of InputData that reads data from a file on disk:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PathInputData</span><span class="p">(</span><span class="n">InputData</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</td></tr></table></div><p>I could have any number of <code>InputData</code> subclasses, like PathInputData, and each of them could implement the standard interface for <code>read</code> to return the data to process. Other <code>InputData</code> subclasses could read from the network, decompress data transparently, and so on.</p><p>I&#39;d want a similar abstract interface for the <code>MapReduce</code> worker that consumes the input data in a standard way:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Worker</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>
</td></tr></table></div><p>Here, I define a concrete subclass of Worker to implement the specific <code>MapReduce</code> function I want to apply—a simple newline counter:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LineCountWorker</span><span class="p">(</span><span class="n">Worker</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">+=</span> <span class="n">other</span><span class="o">.</span><span class="n">result</span>
</pre></div>
</td></tr></table></div><p>It may look like this implementation is going great, but I&#39;ve reached the biggest hurdle in all of this. What connects all of these pieces? I have a nice set of classes with reasonable interfaces and abstractions, but that&#39;s only useful once the objects are constructed. What&#39;s responsible for building the objects and orchestrating the <code>MapReduce</code>?</p><p>The simplest approach is to manually build and connect the objects with some helper functions. Here, I list the contents of a directory and construct a <code>PathInputData</code> instance for each file it contains:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">generate_inputs</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">PathInputData</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</pre></div>
</td></tr></table></div><p>Next, I create the <code>LineCountWorker</code> instances by using the <code>InputData</code> instances returned by <code>generate_inputs</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_workers</span><span class="p">(</span><span class="n">input_list</span><span class="p">):</span>
    <span class="n">workers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">input_data</span> <span class="ow">in</span> <span class="n">input_list</span><span class="p">:</span>
        <span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LineCountWorker</span><span class="p">(</span><span class="n">input_data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">workers</span>
</pre></div>
</td></tr></table></div><p>I execute these Worker instances by fanning out the map step to multiple threads (see Item 53: &quot;Use Threads for Blocking I/O, Avoid for Parallelism&quot; for background). Then, I call reduce repeatedly to combine the results into one final value:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>

<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">workers</span><span class="p">):</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">map</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">workers</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span> <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span> <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">workers</span>
    <span class="k">for</span> <span class="n">worker</span> <span class="ow">in</span> <span class="n">rest</span><span class="p">:</span>
        <span class="n">first</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">first</span><span class="o">.</span><span class="n">result</span>
</pre></div>
</td></tr></table></div><p>Finally, I connect all the pieces together in a function to run each step:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mapreduce</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">generate_inputs</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
    <span class="n">workers</span> <span class="o">=</span> <span class="n">create_workers</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">execute</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>Running this function on a set of test input files works great:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">write_test_files</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="n">tmpdir</span> <span class="o">=</span> <span class="s1">&#39;test_inputs&#39;</span>
<span class="n">write_test_files</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">mapreduce</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;There are {result} lines&#39;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">There</span> <span class="n">are</span> <span class="mi">4360</span> <span class="n">lines</span>
</pre></div>
</td></tr></table></div><p>What&#39;s the problem? The huge issue is that the <code>mapreduce</code> function is not generic at all. If I wanted to write another <code>InputData</code> or <code>Worker</code> subclass, I would also have to rewrite the <code>generate_inputs</code>, <code>create_workers</code>, and <code>mapreduce</code> functions to match.</p><p>This problem boils down to needing a generic way to construct objects. In other languages, you&#39;d solve this problem with constructor polymorphism, requiring that each <code>InputData</code> subclass provides a special constructor that can be used generically by the helper methods that orchestrate the <code>MapReduce</code> (similar to the factory pattern). The trouble is that Python only allows for the single constructor method <code>__init__</code>. It&#39;s unreasonable to require every <code>InputData</code> subclass to have a compatible constructor.</p><p>The best way to solve this problem is with class method polymorphism. This is exactly like the instance method polymorphism I used for <code>InputData.read</code>, except that it&#39;s for whole classes instead of their constructed objects.</p><p>Let me apply this idea to the <code>MapReduce</code> classes. Here, I extend the <code>InputData</code> class with a generic <code>@classmethod</code> that&#39;s responsible for creating new <code>InputData</code> instances using a common interface:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenericInputData</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate_inputs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>
</td></tr></table></div><p>I have <code>generate_inputs</code> take a dictionary with a set of configuration parameters that the <code>GenericInputData</code> concrete subclass needs to interpret. Here, I use the config to find the directory to list for input files:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PathInputData</span><span class="p">(</span><span class="n">GenericInputData</span><span class="p">):</span>
    <span class="c1">#...</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">generate_inputs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="n">data_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">cls</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</pre></div>
</td></tr></table></div><p>Similarly, I can make the <code>create_workers</code> helper part of the <code>GenericWorker</code> class. Here, I use the <code>input_class</code> parameter, which must be a subclass of <code>GenericInputData</code>, to generate the necessary inputs. I construct instances of the <code>GenericWorker</code> concrete subclass by using <code>cls()</code> as a generic constructor:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GenericWorker</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_workers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">input_class</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="n">workers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">input_data</span> <span class="ow">in</span> <span class="n">input_class</span><span class="o">.</span><span class="n">generate_inputs</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
        <span class="n">workers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="p">(</span><span class="n">input_data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">workers</span>
</pre></div>
</td></tr></table></div><p>Note that the call to <code>input_class.generate_inputs</code> above is the class polymorphism that I&#39;m trying to show. You can also see how create_workers calling <code>cls()</code> provides an alternative way to construct <code>GenericWorker</code> objects besides using the <code>__init__</code> method directly.</p><p>The effect on my concrete <code>GenericWorker</code> subclass is nothing more than changing its parent class:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LineCountWorker</span><span class="p">(</span><span class="n">GenericWorker</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</td></tr></table></div><p>Finally, I can rewrite the <code>mapreduce</code> function to be completely generic by calling <code>create_workers</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mapreduce</span><span class="p">(</span><span class="n">worker_class</span><span class="p">,</span> <span class="n">input_class</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="n">workers</span> <span class="o">=</span> <span class="n">worker_class</span><span class="o">.</span><span class="n">create_workers</span><span class="p">(</span><span class="n">input_class</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">execute</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>Running the new worker on a set of test files produces the same result as the old implementation. The difference is that the <code>mapreduce</code> function requires more parameters so that it can operate generically:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data_dir&#39;</span><span class="p">:</span> <span class="n">tmpdir</span><span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">mapreduce</span><span class="p">(</span><span class="n">LineCountWorker</span><span class="p">,</span> <span class="n">PathInputData</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;There are {result} lines&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">There</span> <span class="n">are</span> <span class="mi">4360</span> <span class="n">lines</span>
</pre></div>
</td></tr></table></div><p>Now, I can write other <code>GenericInputData</code> and <code>GenericWorker</code> subclasses as I wish, without having to rewrite any of the glue code.</p><p>Things to Remember
* Python only supports a single constructor per class: the <code>__init__</code> method.
* Use <code>@classmethod</code> to define alternative constructors for your classes.
* Use class method polymorphism to provide generic ways to build and connect many concrete subclasses.</p><span id="item-40-initialize-parent-classes-with-super" class="anchor-target"></span><h2 class="heading">Item 40: Initialize Parent Classes with super <a class="header-link" href="index.html#item-40-initialize-parent-classes-with-super">#</a></h2><hr>
<p>The old, simple way to initialize a parent class from a child class is to directly call the parent class&#39;s <code>__init__</code> method with the child instance:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBaseClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">MyChildClass</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">MyBaseClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>This approach works fine for basic class hierarchies but breaks in many cases.</p><p>If a class is affected by multiple inheritance (something to avoid in general; see Item 41: &quot;Consider Composing Functionality with Mix-in Classes&quot;), calling the superclasses&#39; <code>__init__</code> methods directly can lead to unpredictable behavior.</p><p>One problem is that the <code>__init__</code> call order isn&#39;t specified across all subclasses. For example, here I define two parent classes that operate on the instance&#39;s value field:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TimesTwo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*=</span> <span class="mi">2</span>

<span class="k">class</span> <span class="nc">PlusFive</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">5</span>

<span class="n">This</span> <span class="k">class</span> <span class="nc">defines</span> <span class="n">its</span> <span class="n">parent</span> <span class="n">classes</span> <span class="ow">in</span> <span class="n">one</span> <span class="n">ordering</span><span class="p">:</span>

<span class="k">class</span> <span class="nc">OneWay</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">,</span> <span class="n">TimesTwo</span><span class="p">,</span> <span class="n">PlusFive</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">MyBaseClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">TimesTwo</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">PlusFive</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>And constructing it produces a result that matches the parent class ordering:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">OneWay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;First ordering value is (5 * 2) + 5 =&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">First</span> <span class="n">ordering</span> <span class="n">value</span> <span class="ow">is</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</td></tr></table></div><p>Here&#39;s another class that defines the same parent classes but in a different ordering (PlusFive followed by TimesTwo instead of the other way around):</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AnotherWay</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">,</span> <span class="n">PlusFive</span><span class="p">,</span> <span class="n">TimesTwo</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">MyBaseClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">TimesTwo</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">PlusFive</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>However, I left the calls to the parent class constructors - <code>PlusFive.__init__</code> and <code>TimesTwo.__init__</code> - in the same order as before, which means this class&#39;s behavior doesn&#39;t match the order of the parent classes in its definition. The conflict here between the inheritance
base classes and the <code>__init__</code> calls is hard to spot, which makes this especially difficult for new readers of the code to understand:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">bar</span> <span class="o">=</span> <span class="n">AnotherWay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Second ordering value is&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">Second</span> <span class="n">ordering</span> <span class="n">value</span> <span class="ow">is</span> <span class="mi">15</span>
</pre></div>
</td></tr></table></div><p>Another problem occurs with diamond inheritance. Diamond inheritance happens when a subclass inherits from two separate classes that have the same superclass somewhere in the hierarchy. Diamond inheritance causes the common superclass&#39;s <code>__init__</code> method to run multiple times, causing unexpected behavior. For example, here I define two child classes that inherit from <code>MyBaseClass</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TimesSeven</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">MyBaseClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*=</span> <span class="mi">7</span>

<span class="k">class</span> <span class="nc">PlusNine</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">MyBaseClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">9</span>
</pre></div>
</td></tr></table></div><p>Then, I define a child class that inherits from both of these classes, making <code>MyBaseClass</code> the top of the diamond:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThisWay</span><span class="p">(</span><span class="n">TimesSeven</span><span class="p">,</span> <span class="n">PlusNine</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">TimesSeven</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">PlusNine</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">ThisWay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Should be (5 * 7) + 9 = 44 but is&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">Should</span> <span class="n">be</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">=</span> <span class="mi">44</span> <span class="n">but</span> <span class="ow">is</span> <span class="mi">14</span>
</pre></div>
</td></tr></table></div><p>The call to the second parent class&#39;s constructor, <code>PlusNine.__init__</code>, causes <code>self.value</code> to be reset back to <code>5</code> when <code>MyBaseClass.__init__</code> gets called a second time. That results in the calculation of <code>self.value</code> to be <code>5 + 9 = 14</code>, completely ignoring the effect of the <code>TimesSeven.__init__</code> constructor. This behavior is surprising and can be very difficult to debug in more complex cases.</p><p>To solve these problems, Python has the super built-in function and standard method resolution order (MRO). super ensures that common superclasses in diamond hierarchies are run only once (for another example, see Item 48: &quot;Validate Subclasses with <strong>init_subclass</strong>&quot;). The MRO defines the ordering in which superclasses are initialized, following an algorithm called C3 linearization.</p><p>Here, I create a diamond-shaped class hierarchy again, but this time I use super to initialize the parent class:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TimesSevenCorrect</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*=</span> <span class="mi">7</span>

<span class="k">class</span> <span class="nc">PlusNineCorrect</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">9</span>
</pre></div>
</td></tr></table></div><p>Now, the top part of the diamond, <code>MyBaseClass.__init__</code>, is run only a single time. The other parent classes are run in the order specified in the <code>class</code> statement:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GoodWay</span><span class="p">(</span><span class="n">TimesSevenCorrect</span><span class="p">,</span> <span class="n">PlusNineCorrect</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">GoodWay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Should be 7 * (5 + 9) = 98 and is&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">Should</span> <span class="n">be</span> <span class="mi">7</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="mi">98</span> <span class="ow">and</span> <span class="ow">is</span> <span class="mi">98</span>
</pre></div>
</td></tr></table></div><p>This order may seem backward at first. Shouldn&#39;t <code>TimesSevenCorrect.__init__</code> have run first? Shouldn&#39;t the result be <code>(5 * 7) + 9 = 44</code>? The answer is no. This ordering matches what the
MRO defines for this class. The MRO ordering is available on a class
method called <code>mro</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">mro_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">GoodWay</span><span class="o">.</span><span class="n">mro</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">mro_str</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">GoodWay</span><span class="s1">&#39;&gt;</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">TimesSevenCorrect</span><span class="s1">&#39;&gt;</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">PlusNineCorrect</span><span class="s1">&#39;&gt;</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">MyBaseClass</span><span class="s1">&#39;&gt;</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">object</span><span class="s1">&#39;&gt;</span>
</pre></div>
</td></tr></table></div><p>When I call GoodWay(5), it in turn calls <code>TimesSevenCorrect.__init__</code>, which calls <code>PlusNineCorrect.__init__</code>, which calls <code>MyBaseClass.__init__</code>. Once this reaches the top of the diamond, all of the initialization methods actually do their work in the opposite order from how their <code>__init__</code> functions were called. <code>MyBaseClass.__init__</code> assigns value to 5. <code>PlusNineCorrect.__init__</code> adds 9 to make value equal 14. <code>TimesSevenCorrect.__init__</code> multiplies it by 7 to make value equal 98.</p><p>Besides making multiple inheritance robust, the call to <code>super().__init__</code> is also much more maintainable than calling <code>MyBaseClass.__init__</code> directly from within the subclasses. I could later rename <code>MyBaseClass</code> to something else or have <code>TimesSevenCorrect</code> and <code>PlusNineCorrect</code> inherit from another superclass without having to update their <code>__init__</code> methods to match.</p><p>The super function can also be called with two parameters: first the type of the class whose MRO parent view you&#39;re trying to access, and then the instance on which to access that view. Using these optional parameters within the constructor looks like this:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExplicitTrisect</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExplicitTrisect</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">/=</span> <span class="mi">3</span>
</pre></div>
</td></tr></table></div><p>However, these parameters are not required for object instance initialization. Python&#39;s compiler automatically provides the correct parameters (<code>__class__</code> and <code>self</code>) for you when super is called with zero arguments within a class definition. This means all three of these usages are equivalent:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AutomaticTrisect</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">/=</span> <span class="mi">3</span>

<span class="k">class</span> <span class="nc">ImplicitTrisect</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">/=</span> <span class="mi">3</span>

<span class="k">assert</span> <span class="n">ExplicitTrisect</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="n">AutomaticTrisect</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="n">ImplicitTrisect</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
</td></tr></table></div><p>The only time you should provide parameters to super is in situations where you need to access the specific functionality of a superclass&#39;s implementation from a child class (e.g., to wrap or reuse
functionality).</p><span id="things-to-remember" class="anchor-target"></span><h3 class="heading">Things to Remember <a class="header-link" href="index.html#things-to-remember">#</a></h3><hr>

<ul>
<li>Python&#39;s standard method resolution order (MRO) solves the problems of superclass initialization order and diamond inheritance.</li>
<li>Use the super built-in function with zero arguments to initialize parent classes.</li>
</ul>
<span id="item-41-consider-composing-functionality-with-mix-in-classes" class="anchor-target"></span><h2 class="heading">Item 41: Consider Composing Functionality with Mix-in Classes <a class="header-link" href="index.html#item-41-consider-composing-functionality-with-mix-in-classes">#</a></h2><hr>
<p>Python is an object-oriented language with built-in facilities for making multiple inheritance tractable (see Item 40: &quot;Initialize Parent Classes with super&quot;). However, it&#39;s better to avoid multiple inheritance
altogether.</p><p>If you find yourself desiring the convenience and encapsulation that come with multiple inheritance, but want to avoid the potential headaches, consider writing a mix-in instead. A mix-in is a class that defines only a small set of additional methods for its child classes to
provide. Mix-in classes don&#39;t define their own instance attributes nor require their <code>__init__</code> constructor to be called.</p><p>Writing mix-ins is easy because Python makes it trivial to inspect the current state of any object, regardless of its type. Dynamic inspection means you can write generic functionality just once, in a mix-in, and it can then be applied to many other classes. Mix-ins can be com posed and layered to minimize repetitive code and maximize reuse.</p><p>For example, say I want the ability to convert a Python object from its in-memory representation to a dictionary that&#39;s ready for serialization. Why not write this functionality generically so I can use it with
all my classes?</p><p>Here, I define an example mix-in that accomplishes this with a new public method that&#39;s added to any class that inherits from it:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ToDictMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>The implementation details are straightforward and rely on dynamic attribute access using hasattr, dynamic type inspection with <code>isinstance</code>, and accessing the instance dictionary <code>__dict__</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_traverse_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_dict</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">instance_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ToDictMixin</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traverse_dict</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</td></tr></table></div><p>Here, I define an example class that uses the mix-in to make a dictionary representation of a binary tree:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinaryTree</span><span class="p">(</span><span class="n">ToDictMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>
</pre></div>
</td></tr></table></div><p>Translating a large number of related Python objects into a dictionary becomes easy:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">BinaryTree</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">left</span><span class="o">=</span><span class="n">BinaryTree</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">BinaryTree</span><span class="p">(</span><span class="mi">9</span><span class="p">)),</span>
    <span class="n">right</span><span class="o">=</span><span class="n">BinaryTree</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">BinaryTree</span><span class="p">(</span><span class="mi">11</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}},</span>
<span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
        <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">},</span>
        <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}}</span>
</pre></div>
</td></tr></table></div><p>The best part about mix-ins is that you can make their generic functionality pluggable so behaviors can be overridden when required. For example, here I define a subclass of <code>BinaryTree</code> that holds a reference to its parent. This circular reference would cause the default imple
mentation of <code>ToDictMixin.to_dict</code> to loop forever:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinaryTreeWithParent</span><span class="p">(</span><span class="n">BinaryTree</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</pre></div>
</td></tr></table></div><p>The solution is to override the <code>BinaryTreeWithParent._traverse</code> method to only process values that matter, preventing cycles encountered by the mix-in. Here, the <code>_traverse</code> override inserts the parent&#39;s numerical value and otherwise defers to the mix-in&#39;s default implementation
by using the super built-in function:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">BinaryTreeWithParent</span><span class="p">)</span> <span class="ow">and</span>
                <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;parent&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="c1"># Prevent cycles</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>Calling <code>BinaryTreeWithParent.to_dict</code> works without issue because the circular referencing properties aren&#39;t followed:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">BinaryTreeWithParent</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">BinaryTreeWithParent</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">BinaryTreeWithParent</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span>
        <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
<span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
<span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
</pre></div>
</td></tr></table></div><p>By defining <code>BinaryTreeWithParent._traverse</code>, I&#39;ve also enabled any class that has an attribute of type <code>BinaryTreeWithParent</code> to automatically work with the <code>ToDictMixin</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NamedSubTree</span><span class="p">(</span><span class="n">ToDictMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tree_with_parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_with_parent</span> <span class="o">=</span> <span class="n">tree_with_parent</span>

<span class="n">my_tree</span> <span class="o">=</span> <span class="n">NamedSubTree</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">my_tree</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="c1"># No infinite loop</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foobar&#39;</span><span class="p">,</span>
<span class="s1">&#39;tree_with_parent&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                    <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                    <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                    <span class="s1">&#39;parent&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}}</span>
</pre></div>
</td></tr></table></div><p>Mix-ins can also be composed together. For example, say I want a mix-in that provides generic JSON serialization for any class. I can do this by assuming that a class provides a <code>to_dict</code> method (which may or may not be provided by the <code>ToDictMixin</code> class):</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">class</span> <span class="nc">JsonMixin</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</pre></div>
</td></tr></table></div><p>Note how the <code>JsonMixin</code> class defines both instance methods and class methods. Mix-ins let you add either kind of behavior to subclasses. In this example, the only requirements of a <code>JsonMixin</code> subclass are providing a <code>to_dict</code> method and taking keyword arguments for the <code>__init__</code> method (see Item 23: &quot;Provide Optional Behavior with Keyword Arguments&quot; for background).</p><p>This mix-in makes it simple to create hierarchies of utility classes that can be serialized to and from JSON with little boilerplate. For example, here I have a hierarchy of data classes representing parts of a datacenter topology:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DatacenterRack</span><span class="p">(</span><span class="n">ToDictMixin</span><span class="p">,</span> <span class="n">JsonMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">switch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">machines</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switch</span> <span class="o">=</span> <span class="n">Switch</span><span class="p">(</span><span class="o">**</span><span class="n">switch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">machines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Machine</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">machines</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Switch</span><span class="p">(</span><span class="n">ToDictMixin</span><span class="p">,</span> <span class="n">JsonMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>

<span class="k">class</span> <span class="nc">Machine</span><span class="p">(</span><span class="n">ToDictMixin</span><span class="p">,</span> <span class="n">JsonMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ram</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">disk</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cores</span> <span class="o">=</span> <span class="n">cores</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ram</span> <span class="o">=</span> <span class="n">ram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disk</span> <span class="o">=</span> <span class="n">disk</span>
</pre></div>
</td></tr></table></div><p>Serializing these classes to and from JSON is simple. Here, I verify that the data is able to be sent round-trip through serializing and deserializing:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">serialized</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">    &quot;switch&quot;: {&quot;ports&quot;: 5, &quot;speed&quot;: 1e9},</span>
<span class="s2">    &quot;machines&quot;: [</span>
<span class="s2">        {&quot;cores&quot;: 8, &quot;ram&quot;: 32e9, &quot;disk&quot;: 5e12},</span>
<span class="s2">        {&quot;cores&quot;: 4, &quot;ram&quot;: 16e9, &quot;disk&quot;: 1e12},</span>
<span class="s2">        {&quot;cores&quot;: 2, &quot;ram&quot;: 4e9, &quot;disk&quot;: 500e9}</span>
<span class="s2">    ]</span>
<span class="s2">}&quot;&quot;&quot;</span>

<span class="n">deserialized</span> <span class="o">=</span> <span class="n">DatacenterRack</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>
<span class="n">roundtrip</span> <span class="o">=</span> <span class="n">deserialized</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span> <span class="o">==</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">roundtrip</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>When you use mix-ins like this, it&#39;s fine if the class you apply <code>JsonMixin</code> to already inherits from <code>JsonMixin</code> higher up in the class hierarchy. The resulting class will behave the same way, thanks to the behavior of <code>super</code>.</p><span id="things-to-remember" class="anchor-target"></span><h3 class="heading">Things to Remember <a class="header-link" href="index.html#things-to-remember">#</a></h3><hr>

<ul>
<li>Avoid using multiple inheritance with instance attributes and <code>__init__</code> if mix-in classes can achieve the same outcome.</li>
<li>Use pluggable behaviors at the instance level to provide per-class customization when mix-in classes may require it.
Things to Remember</li>
<li>Avoid using multiple inheritance with instance attributes and <code>__init__</code> if mix-in classes can achieve the same outcome.</li>
<li>Use pluggable behaviors at the instance level to provide per-class customization when mix-in classes may require it.</li>
</ul>
<span id="item-42-prefer-public-attributes-over-private-ones" class="anchor-target"></span><h2 class="heading">Item 42: Prefer Public Attributes Over Private Ones <a class="header-link" href="index.html#item-42-prefer-public-attributes-over-private-ones">#</a></h2><hr>
<p>In Python, there are only two types of visibility for a class&#39;s attributes: public and private:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">public_field</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private_field</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">get_private_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_field</span>
</pre></div>
</td></tr></table></div><p>Public attributes can be accessed by anyone using the dot operator on the object:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">public_field</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</td></tr></table></div><p>Private fields are specified by prefixing an attribute&#39;s name with a double underscore. They can be accessed directly by methods of the containing class:</p><div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">get_private_field</span><span class="p">()</span> <span class="o">==</span> <span class="mi">10</span>
</pre></div>
</div><p>However, directly accessing private fields from outside the class raises an exception:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">.</span><span class="n">__private_field</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Traceback</span> <span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;MyObject&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;__private_field&#39;</span>
</pre></div>
</td></tr></table></div><p>Class methods also have access to private attributes because they are declared within the surrounding class block:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyOtherObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private_field</span> <span class="o">=</span> <span class="mi">71</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_private_field_of_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="n">__private_field</span>

<span class="n">bar</span> <span class="o">=</span> <span class="n">MyOtherObject</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">MyOtherObject</span><span class="o">.</span><span class="n">get_private_field_of_instance</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="o">==</span> <span class="mi">71</span>
</pre></div>
</td></tr></table></div><p>As you&#39;d expect with private fields, a subclass can&#39;t access its parent class&#39;s private fields:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyParentObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private_field</span> <span class="o">=</span> <span class="mi">71</span>

<span class="k">class</span> <span class="nc">MyChildObject</span><span class="p">(</span><span class="n">MyParentObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_private_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_field</span>

<span class="n">baz</span> <span class="o">=</span> <span class="n">MyChildObject</span><span class="p">()</span>
<span class="n">baz</span><span class="o">.</span><span class="n">get_private_field</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Traceback</span> <span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;MyChildObject&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;_MyChildObject__private_field&#39;</span>
</pre></div>
</td></tr></table></div><p>The private attribute behavior is implemented with a simple transformation of the attribute name. When the Python compiler sees private attribute access in methods like <code>MyChildObject.get_private_field</code>, it translates the <code>__private_field</code> attribute access to use the name <code>_MyChildObject__private_field</code> instead. In the example above, <code>__private_field</code> is only defined in <code>MyParentObject.__init__</code>, which means the private attribute&#39;s real name is <code>_MyParentObject__private_field</code>. Accessing the parent&#39;s private attribute from the child class fails simply because the transformed attribute name doesn&#39;t exist (<code>_MyChildObject__private_field</code> instead of <code>_MyParentObject__private_field</code>).</p><p>Knowing this scheme, you can easily access the private attributes of any class-from a subclass or externally-without asking for permission:</p><div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">baz</span><span class="o">.</span><span class="n">_MyParentObject__private_field</span> <span class="o">==</span> <span class="mi">71</span>
</pre></div>
</div><p>If you look in the object&#39;s attribute dictionary, you can see that private attributes are actually stored with the names as they appear after the transformation:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">baz</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="p">{</span><span class="s1">&#39;_MyParentObject__private_field&#39;</span><span class="p">:</span> <span class="mi">71</span><span class="p">}</span>
</pre></div>
</td></tr></table></div><p>Why doesn&#39;t the syntax for private attributes actually enforce strict visibility? The simplest answer is one often-quoted motto of Python: &quot;We are all consenting adults here.&quot; What this means is that we don&#39;t need the language to prevent us from doing what we want to do. It&#39;s
our individual choice to extend functionality as we wish and to take responsibility for the consequences of such a risk. Python programmers believe that the benefits of being open—permitting unplanned extension of classes by default—outweigh the downsides.</p><p>Beyond that, having the ability to hook language features like attribute access (see Item 47: &quot;Use <code>__getattr__</code>, <code>__getattribute__</code>, and <code>__setattr__</code> for Lazy Attributes&quot;) enables you to mess around with the internals of objects whenever you wish. If you can do that, what is the
value of Python trying to prevent private attribute access otherwise?</p><p>To minimize damage from accessing internals unknowingly, Python programmers follow a naming convention defined in the style guide (see Item 2: &quot;Follow the PEP 8 Style Guide&quot;). Fields prefixed by a single underscore (like <code>_protected_field</code>) are protected by convention, meaning external users of the class should proceed with caution.</p><p>However, many programmers who are new to Python use private fields to indicate an internal API that shouldn&#39;t be accessed by subclasses or externally:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStringClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__value</span><span class="p">)</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">MyStringClass</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;5&#39;</span>
</pre></div>
</td></tr></table></div><p>This is the wrong approach. Inevitably someone-maybe even you-will want to subclass your class to add new behavior or to work around deficiencies in existing methods (e.g., the way that
<code>MyStringClass.get_value</code> always returns a string). By choosing private attributes, you&#39;re only making subclass overrides and extensions cumbersome and brittle. Your potential subclassers will still access the private fields when they absolutely need to do so:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyIntegerSubclass</span><span class="p">(</span><span class="n">MyStringClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MyStringClass__value</span><span class="p">)</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">MyIntegerSubclass</span><span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</td></tr></table></div><p>But if the class hierarchy changes beneath you, these classes will break because the private attribute references are no longer valid. Here, the <code>MyIntegerSubclass</code> class&#39;s immediate parent, <code>MyStringClass</code>, has had another parent class added, called <code>MyBaseClass</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyBaseClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span>

<span class="k">class</span> <span class="nc">MyStringClass</span><span class="p">(</span><span class="n">MyBaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span> <span class="c1"># Updated</span>

<span class="k">class</span> <span class="nc">MyIntegerSubclass</span><span class="p">(</span><span class="n">MyStringClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MyStringClass__value</span><span class="p">)</span> <span class="c1"># Not updated</span>
</pre></div>
</td></tr></table></div><p>The <code>__value</code> attribute is now assigned in the MyBaseClass parent class, not the <code>MyStringClass</code> parent. This causes the private variable reference <code>self._MyStringClass__value</code> to break in <code>MyIntegerSubclass</code>:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">MyIntegerSubclass</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">foo</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Traceback</span> <span class="o">...</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;MyIntegerSubclass&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;_MyStringClass__value&#39;</span>
</pre></div>
</td></tr></table></div><p>In general, it&#39;s better to err on the side of allowing subclasses to do more by using protected attributes. Document each protected field and explain which fields are internal APIs available to subclasses and which should be left alone entirely. This is as much advice to other programmers as it is guidance for your future self on how to extend your own code safely:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStringClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># This stores the user-supplied value for the object.</span>
        <span class="c1"># It should be coercible to a string. Once assigned in</span>
        <span class="c1"># the object it should be treated as immutable.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">...</span>
</pre></div>
</td></tr></table></div><p>The only time to seriously consider using private attributes is when you&#39;re worried about naming conflicts with subclasses. This problem occurs when a child class unwittingly defines an attribute that was already defined by its parent class:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ApiClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">ApiClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span> <span class="c1"># Conflicts</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Child</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{a.get()} and {a._value} should be different&#39;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">hello</span> <span class="ow">and</span> <span class="n">hello</span> <span class="n">should</span> <span class="n">be</span> <span class="n">different</span>
</pre></div>
</td></tr></table></div><p>This is primarily a concern with classes that are part of a public API; the subclasses are out of your control, so you can&#39;t refactor to fix the problem. Such a conflict is especially possible with attribute names that are very common (like value). To reduce the risk of this
issue occurring, you can use a private attribute in the parent class to ensure that there are no attribute names that overlap with child classes:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ApiClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># Double underscore</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="c1"># Double underscore</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">ApiClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span> <span class="c1"># OK!</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Child</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{a.get()} and {a._value} are different&#39;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="mi">5</span> <span class="ow">and</span> <span class="n">hello</span> <span class="n">are</span> <span class="n">different</span>
</pre></div>
</td></tr></table></div><span id="things-to-remember" class="anchor-target"></span><h3 class="heading">Things to Remember <a class="header-link" href="index.html#things-to-remember">#</a></h3><hr>

<ul>
<li>Private attributes aren&#39;t rigorously enforced by the Python compiler.</li>
<li>Plan from the beginning to allow subclasses to do more with your internal APIs and attributes instead of choosing to lock them out.</li>
<li>Use documentation of protected fields to guide subclasses instead of trying to force access control with private attributes.</li>
<li>Only consider using private attributes to avoid naming conflicts with subclasses that are out of your control.</li>
</ul>
<span id="item-43-inherit-from-collectionsabc-for-custom-container-types" class="anchor-target"></span><h2 class="heading">Item 43: Inherit from collections.abc for Custom Container Types <a class="header-link" href="index.html#item-43-inherit-from-collectionsabc-for-custom-container-types">#</a></h2><hr>
<p>Much of programming in Python is defining classes that contain data and describing how such objects relate to each other. Every Python class is a container of some kind, encapsulating attributes and functionality together. Python also provides built-in container types for
managing data: lists, tuples, sets, and dictionaries.</p><p>When you&#39;re designing classes for simple use cases like sequences, it&#39;s natural to want to subclass Python&#39;s built-in list type directly. For example, say I want to create my own custom list type that has additional methods for counting the frequency of its members:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FrequencyList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">members</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">counts</span>
</pre></div>
</td></tr></table></div><p>By subclassing list, I get all of list&#39;s standard functionality and pre serve the semantics familiar to all Python programmers. I can define additional methods to provide any custom behaviors that I need:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">FrequencyList</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Length is&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>

<span class="n">foo</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;After pop:&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Frequency:&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">.</span><span class="n">frequency</span><span class="p">())</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Length</span> <span class="ow">is</span> <span class="mi">7</span>
<span class="n">After</span> <span class="n">pop</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="n">Frequency</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</td></tr></table></div><p>Now, imagine that I want to provide an object that feels like a list and allows indexing but isn&#39;t a list subclass. For example, say that I want to provide sequence semantics (like list or tuple) for a binary tree class:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinaryNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>
</pre></div>
</td></tr></table></div><p>How do you make this class act like a sequence type? Python implements its container behaviors with instance methods that have special names. When you access a sequence item by index:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">bar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</td></tr></table></div><p>it will be interpreted as:</p><div class="codeblock language-python"><div class="highlight"><pre><span></span><span class="n">bar</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div><p>To make the <code>BinaryNode</code> class act like a sequence, you can provide a custom implementation of <code>__getitem__</code> (often pronounced &quot;dunder getitem&quot; as an abbreviation for &quot;double underscore getitem&quot;) that traverses the object tree depth first:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IndexableNode</span><span class="p">(</span><span class="n">BinaryNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">_traverse</span><span class="p">()</span>
        <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">_traverse</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span>                    
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Index {index} is out of range&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>You can construct your binary tree as usual:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">IndexableNode</span><span class="p">(</span>
    <span class="mi">10</span><span class="p">,</span>
    <span class="n">left</span><span class="o">=</span><span class="n">IndexableNode</span><span class="p">(</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">IndexableNode</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">right</span><span class="o">=</span><span class="n">IndexableNode</span><span class="p">(</span>
                <span class="mi">6</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="n">IndexableNode</span><span class="p">(</span><span class="mi">7</span><span class="p">))),</span>
    <span class="n">right</span><span class="o">=</span><span class="n">IndexableNode</span><span class="p">(</span>
    <span class="mi">15</span><span class="p">,</span>
    <span class="n">left</span><span class="o">=</span><span class="n">IndexableNode</span><span class="p">(</span><span class="mi">11</span><span class="p">)))</span>
</pre></div>
</td></tr></table></div><p>But you can also access it like a list in addition to being able to traverse the tree with the left and right attributes:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;LRR is&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Index 0 is&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Index 1 is&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;11 in the tree?&#39;</span><span class="p">,</span> <span class="mi">11</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;17 in the tree?&#39;</span><span class="p">,</span> <span class="mi">17</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Tree is&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">LRR</span> <span class="ow">is</span> <span class="mi">7</span>
<span class="n">Index</span> <span class="mi">0</span> <span class="ow">is</span> <span class="mi">2</span>
<span class="n">Index</span> <span class="mi">1</span> <span class="ow">is</span> <span class="mi">5</span>
<span class="mi">11</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">tree</span><span class="err">?</span> <span class="bp">True</span>
<span class="mi">17</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">tree</span><span class="err">?</span> <span class="bp">False</span>
<span class="n">Tree</span> <span class="ow">is</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
</pre></div>
</td></tr></table></div><p>The problem is that implementing <code>__getitem__</code> isn&#39;t enough to provide all of the sequence semantics you&#39;d expect from a list instance:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Traceback</span> <span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="nb">object</span> <span class="n">of</span> <span class="nb">type</span> <span class="s1">&#39;IndexableNode&#39;</span> <span class="n">has</span> <span class="n">no</span> <span class="nb">len</span><span class="p">()</span>
</pre></div>
</td></tr></table></div><p>The <code>len</code> built-in function requires another special method, named <code>__len__</code>, that must have an implementation for a custom sequence type:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SequenceNode</span><span class="p">(</span><span class="n">IndexableNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traverse</span><span class="p">(),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">count</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">SequenceNode</span><span class="p">(</span>
    <span class="mi">10</span><span class="p">,</span>
    <span class="n">left</span><span class="o">=</span><span class="n">SequenceNode</span><span class="p">(</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="n">SequenceNode</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">right</span><span class="o">=</span><span class="n">SequenceNode</span><span class="p">(</span>
            <span class="mi">6</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">SequenceNode</span><span class="p">(</span><span class="mi">7</span><span class="p">))),</span>
    <span class="n">right</span><span class="o">=</span><span class="n">SequenceNode</span><span class="p">(</span>
    <span class="mi">15</span><span class="p">,</span>
    <span class="n">left</span><span class="o">=</span><span class="n">SequenceNode</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Tree length is&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Tree</span> <span class="n">length</span> <span class="ow">is</span> <span class="mi">7</span>
</pre></div>
</td></tr></table></div><p>Unfortunately, this still isn&#39;t enough for the class to fully be a valid sequence. Also missing are the count and index methods that a Python programmer would expect to see on a sequence like list or tuple. It turns out that defining your own container types is much
harder than it seems.</p><p>To avoid this difficulty throughout the Python universe, the built-in <code>collections.abc</code> module defines a set of abstract base classes that provide all of the typical methods for each container type. When you subclass from these abstract base classes and forget to implement
required methods, the module tells you something is wrong:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="k">class</span> <span class="nc">BadType</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">BadType</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Traceback</span> <span class="o">...</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">Can</span><span class="s1">&#39;t instantiate abstract class BadType with abstract methods __getitem__, __len__</span>
</pre></div>
</td></tr></table></div><p>When you do implement all the methods required by an abstract base class from <code>collections.abc</code>, as I did above with <code>SequenceNode</code>, it provides all of the additional methods, like <code>index</code> and <code>count</code>, for free:</p><div class="codeblock language-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BetterNode</span><span class="p">(</span><span class="n">SequenceNode</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">BetterNode</span><span class="p">(</span>
    <span class="mi">10</span><span class="p">,</span>
    <span class="n">left</span><span class="o">=</span><span class="n">BetterNode</span><span class="p">(</span>
        <span class="mi">5</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="n">BetterNode</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">right</span><span class="o">=</span><span class="n">BetterNode</span><span class="p">(</span>
            <span class="mi">6</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">BetterNode</span><span class="p">(</span><span class="mi">7</span><span class="p">))),</span>
    <span class="n">right</span><span class="o">=</span><span class="n">BetterNode</span><span class="p">(</span>
        <span class="mi">15</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="n">BetterNode</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
    <span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Index of 7 is&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Count of 10 is&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Index</span> <span class="n">of</span> <span class="mi">7</span> <span class="ow">is</span> <span class="mi">3</span>
<span class="n">Count</span> <span class="n">of</span> <span class="mi">10</span> <span class="ow">is</span> <span class="mi">1</span>
</pre></div>
</td></tr></table></div><p>The benefit of using these abstract base classes is even greater for
more complex container types such as <code>Set</code> and <code>MutableMapping</code>, which
have a large number of special methods that need to be implemented
to match Python conventions.</p><p>Beyond the <code>collections.abc</code> module, Python uses a variety of special
methods for object comparisons and sorting, which may be provided
by container classes and non-container classes alike (see Item 73:
&quot;Know How to Use heapq for Priority Queues&quot; for an example).</p><span id="things-to-remember" class="anchor-target"></span><h3 class="heading">Things to Remember <a class="header-link" href="index.html#things-to-remember">#</a></h3><hr>

<ul>
<li>Inherit directly from Python&#39;s container types (like list or dict) for simple use cases.</li>
<li>Beware of the large number of methods required to implement custom container types correctly.</li>
<li>Have your custom container types inherit from the interfaces defined in <code>collections.abc</code> to ensure that your classes match required interfaces and behaviors.</li>
</ul>

        <div class="admonition note">        <p class="admonition-title"><strong><i class="fa fa-info-circle" aria-hidden="true"></i> note:        </strong></p><p>This is a except from <a href="http://www.informit.com/store/effective-python-90-specific-ways-to-write-better-python-9780134853987">Effective Python: 90 Specific Ways to Write Better Python, 2nd Edition
</a></p></div>
        

<hr>

<p>Other Tutorials (Sponsors)</p>

<p class="advert">
    This site generously supported by
    <a rel="sponsored noopener" target="_blank"
       href="https://www.datacamp.com/?utm_source=thepythonguru&utm_campaign=thepythonguru_tutorials">
        DataCamp</a>. DataCamp offers online interactive
    <a rel="sponsored noopener" target="_blank" href="https://www.datacamp.com/courses/?utm_source=thepythonguru&utm_campaign=thepythonguru_tutorials">
        Python Tutorials
    </a> for Data Science. Join over a million other learners and get
    started learning Python for data science today!
</p>


    



        <nav aria-label="pagination">
            <ul class="pager">
                
                    <li class="previous">
                        <a href="../how-to-build-probabilistic-models-with-pymc3-in-bayesian/index.html" title="How to build probabilistic models with PyMC3 in Bayesian">
                            <span class="fa fa-arrow-left" aria-hidden="true"></span>
                            How to build probabilistic models with …
                        </a>
                    </li>
                

                
                    <li class="next">
                        <a href="../convnets-the-driving-engine-behind-computer-vision/index.html" title="ConvNets – the driving engine behind computer vision">
                            ConvNets – the driving engine behind co…
                            <span class="fa fa-arrow-right" aria-hidden="true"></span>
                        </a>
                    </li>
                
            </ul>
        </nav>





<hr>



    <div id="disqus_thread">
    <p style="margin-bottom: 22px" class="text-center">
        <a href="index.html#" class=" btn btn-primary comments-holder" onclick="loadDisqus();return false;">View Comments</a>
    </p>
    </div>
    <script>
        var is_disqus_loaded = false;
        function loadDisqus() { // DON'T EDIT BELOW THIS LINE
            is_disqus_loaded = true;
            var d = document, s = d.createElement('script');
            s.src = 'https://thepythonguru.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>







            </div>
        </div>


        <div class="sidebar">
        
            <div class="col-lg-4 col-md-4 col-sm-12">
                

    
        

<div class="well">
    <form action="https://thepythonguru.com/search/">
        <div class="input-group">
            <input type="text" class="form-control" name="query" placeholder="Search here"
                   value="">
            <span class="input-group-btn">
                            <button class="btn btn-default" type="submit">
                                <span class="glyphicon glyphicon-search"></span>
                        </button>
                        </span>
        </div>
    </form>
    <!-- /.input-group -->
</div>

<div class="well" id="myAffix">
    <a href="https://www.datacamp.com/" rel="noopener">
        <img class="center-block" src="../static/wiki/images/filip_ad.png" alt="">
    </a>
</div>



<div class="well">
    <h4>Recent Posts</h4>
    <ul>
        
            <li><a href="../tips-to-become-a-top-gamer/index.html">Tips to Become a Top Gamer</a></li>
        
            <li><a href="../choosing-the-right-database-service-factors-to-consider-for-scalability-security-and-performance/index.html">Choosing the Right Database Service: Factors to Consider for Scalability, Security, and Performance</a></li>
        
            <li><a href="../benefits-of-using-python-for-cyber-security/index.html">Benefits of Using Python for Cyber Security</a></li>
        
            <li><a href="../vue-vs-react-what-are-the-best-js-technologies-in-2023/index.html">Vue VS React: What Are The Best JS Technologies In 2023</a></li>
        
            <li><a href="../why-you-should-choose-python-in-2023/index.html">Why You Should Choose Python in 2023?</a></li>
        

    </ul>
</div>

    

    
        
    


            </div>
        </div>
    </div>



    <hr>

    <!-- Footer -->
    <footer class="text-center tpg-footer" >
        <div class="row">
            <div class="col-lg-12">
                <ul class="tpg-footer-links text-center">
                    <li><a href="../about/index.html">About</a></li>
                    <li><a href="../terms-of-use/index.html">Terms</a></li>
                    <li><a href="../privacy-policy/index.html">Privacy Policy</a></li>
                    <li><a href="../contact-us/index.html">Contact</a></li>
                </ul>
                <hr>
                <p>&copy; 2025 ThePythonGuru.com</p>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
    </footer>

</div>

<script type="text/javascript" src="../static/CACHE/js/output.1879f88478d8.js"></script>




<script>
    window.cookieconsent.initialise({
        "palette": {
            "popup": {
                "background": "#252e39"
            },
            "button": {
                "background": "#14a7d0"
            }
        },
        "theme": "classic",
        "content": {
            "href": "https://thepythonguru.com/privacy-policy/"
        }
    });
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

</body>
</html>

